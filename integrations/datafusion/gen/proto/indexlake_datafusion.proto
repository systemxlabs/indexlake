syntax = "proto3";

package indexlake_datafusion;

import "datafusion_common.proto";
import "datafusion.proto";

message IndexLakePhysicalPlanNode {
  oneof IndexLakePhysicalPlanType {
    IndexLakeScanExecNode scan = 1;
    IndexLakeInsertExecNode insert = 2;
    MemoryDatasourceNode memory_datasource = 3;
  }
}

message IndexLakeScanExecNode {
  string namespace_name = 1;
  string table_name = 2;
  uint32 partition_count = 3;
  DataFiles data_files = 4;
  optional uint32 concurrency = 5;
  Projection projection = 6;
  repeated datafusion.LogicalExprNode filters = 7;
  optional uint32 limit = 8;
}

message IndexLakeInsertExecNode {
  string namespace_name = 1;
  string table_name = 2;
  datafusion.InsertOp insert_op = 3;
}

message MemoryDatasourceNode {
  repeated bytes partitions = 1;
  datafusion_common.Schema schema = 2;
  Projection projection = 3;
  repeated datafusion.PhysicalSortExprNodeCollection sort_information = 4;  
  bool show_sizes = 5;
  optional uint32 fetch = 6;
}

message Projection {
  repeated uint32 projection = 1;
}

message DataFiles {
  repeated DataFile files = 1;
}

message DataFile {
  bytes data_file_id = 1;
  bytes table_id = 2;
  DataFileFormat format = 3;
  string relative_path = 4;
  int64 record_count = 5;
  repeated bytes row_ids = 6;
  repeated bool validity = 7;
}

enum DataFileFormat {
  ParquetV1 = 0;
  ParquetV2 = 1;
}